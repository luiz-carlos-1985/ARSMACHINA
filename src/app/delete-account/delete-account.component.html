<div class="delete-account-container">
  <div class="delete-account-card">
    <!-- Step 1: Initial Warning -->
    <div *ngIf="step === 1" class="step-content">
      <div class="warning-header">
        <h2 style="color: black;">‚ö†Ô∏è Excluir Conta</h2>
        <p class="warning-text" style="color: red;">Esta a√ß√£o √© <strong>irrevers√≠vel</strong> e n√£o pode ser desfeita.</p>
      </div>

      <div class="warning-list">
        <h3>O que ser√° perdido:</h3>
        <ul>
          <li style="color: black;">‚úó Todos os seus dados pessoais</li>
          <li style="color: black;">‚úó Hist√≥rico de atividades</li>
          <li style="color: black;">‚úó Configura√ß√µes personalizadas</li>
          <li style="color: black;">‚úó Acesso √† plataforma</li>
        </ul>
      </div>

      <div class="user-info">
        <p style="color: black;">Conta a ser exclu√≠da: <strong>{{ currentUserEmail }}</strong></p>
      </div>

      <div class="step-actions">
        <button type="button" class="btn-secondary" (click)="cancel()">
          Cancelar
        </button>
        <button type="button" class="btn-danger" (click)="nextStep()">
          Continuar com Exclus√£o
        </button>
      </div>
    </div>

    <!-- Step 2: Password Verification -->
    <div *ngIf="step === 2" class="step-content">
      <div class="auth-header">
        <h2 style="color: black;">üîê Verifica√ß√£o de Identidade</h2>
        <p style="color: red;">Digite sua senha atual para confirmar sua identidade</p>
      </div>

      <form [formGroup]="deleteForm">
        <div class="form-group">
          <label for="password" style="color: black;">Senha Atual:</label>
          <div class="input-container">
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              formControlName="password"
              placeholder="Digite sua senha atual"
              [class]="getPasswordFieldClass()"
            />
            <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
              {{ showPassword ? 'üëÅÔ∏è' : 'üôà' }}
            </button>
          </div>
        </div>
      </form>

      <div class="step-actions">
        <button type="button" class="btn-secondary" (click)="previousStep()">
          ‚Üê Voltar
        </button>
        <button 
          type="button" 
          class="btn-primary" 
          (click)="verifyPassword()"
          [disabled]="isLoading || !deleteForm.get('password')?.value">
          <span *ngIf="!isLoading">üîê Verificar Senha</span>
          <span *ngIf="isLoading">
            <span class="loading-spinner"></span>
            Verificando...
          </span>
        </button>
      </div>
    </div>

    <!-- Step 3: Final Confirmation -->
    <div *ngIf="step === 3" class="step-content">
      <div class="final-warning">
        <h2 style="color: black;">üö® Confirma√ß√£o Final</h2>
        <p class="danger-text">
          <strong>√öLTIMA CHANCE!</strong> Esta a√ß√£o excluir√° permanentemente sua conta.
        </p>
      </div>

      <form [formGroup]="deleteForm">
        <div class="form-group">
          <label for="reason" style="color: black;">Motivo da exclus√£o (obrigat√≥rio):</label>
          <select id="reason" formControlName="reason">
            <option value="">Selecione um motivo</option>
            <option value="not-using">N√£o uso mais o servi√ßo</option>
            <option value="privacy">Preocupa√ß√µes com privacidade</option>
            <option value="technical">Problemas t√©cnicos</option>
            <option value="cost">Quest√µes de custo</option>
            <option value="other">Outro motivo</option>
          </select>
        </div>

        <div class="form-group">
          <label for="confirmText" style="color: black;">
            Digite <strong>"EXCLUIR CONTA"</strong> para confirmar:
          </label>
          <input
            type="text"
            id="confirmText"
            formControlName="confirmText"
            placeholder="EXCLUIR CONTA"
            [class]="getConfirmTextFieldClass()"
          />
          <div *ngIf="deleteForm.get('confirmText')?.errors?.['invalidConfirmText'] && deleteForm.get('confirmText')?.touched" class="error">
            Digite exatamente "EXCLUIR CONTA"
          </div>
        </div>
      </form>
      
      <div class="form-status" *ngIf="!isStep3FormValid()">
        <p class="status-warning">
          ‚ö†Ô∏è Complete todos os campos para habilitar a exclus√£o
        </p>
        <ul class="status-checklist">
          <li [class.completed]="deleteForm.get('reason')?.value">
            {{ deleteForm.get('reason')?.value ? '‚úì' : '‚úó' }} Motivo selecionado
          </li>
          <li [class.completed]="deleteForm.get('confirmText')?.value === 'EXCLUIR CONTA'">
            {{ deleteForm.get('confirmText')?.value === 'EXCLUIR CONTA' ? '‚úì' : '‚úó' }} Texto de confirma√ß√£o
          </li>
          <li [class.completed]="deleteForm.get('password')?.value">
            {{ deleteForm.get('password')?.value ? '‚úì' : '‚úó' }} Senha verificada
          </li>
        </ul>
      </div>

      <div class="step-actions">
        <button type="button" class="btn-secondary" (click)="previousStep()">
          ‚Üê Voltar
        </button>
        <button 
          type="button" 
          class="btn-danger-final" 
          (click)="deleteAccount()"
          [disabled]="isLoading || !isStep3FormValid()">
          <span *ngIf="!isLoading">üóëÔ∏è EXCLUIR CONTA PERMANENTEMENTE</span>
          <span *ngIf="isLoading">
            <span class="loading-spinner"></span>
            Excluindo...
          </span>
        </button>
      </div>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="success-message">
      {{ successMessage }}
    </div>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
      <div class="step-indicator" [class.active]="step >= 1" [class.completed]="step > 1">1</div>
      <div class="step-line" [class.completed]="step > 1"></div>
      <div class="step-indicator" [class.active]="step >= 2" [class.completed]="step > 2">2</div>
      <div class="step-line" [class.completed]="step > 2"></div>
      <div class="step-indicator" [class.active]="step >= 3">3</div>
    </div>
  </div>
</div>