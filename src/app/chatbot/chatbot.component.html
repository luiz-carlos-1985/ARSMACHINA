<div class="chatbot-container" [class.minimized]="isMinimized">
  <!-- Minimized State -->
  <div *ngIf="isMinimized" class="chatbot-minimized" (click)="toggleChat()">
    <div class="chat-icon">💬</div>
    <div *ngIf="unreadCount > 0" class="unread-badge">{{ unreadCount }}</div>
    <div *ngIf="showInfoBalloon" class="info-balloon">
      {{ getRandomGreeting() }}
      <button (click)="showInfoBalloon = false; $event.stopPropagation()">×</button>
    </div>
  </div>

  <!-- Expanded State -->
  <div *ngIf="!isMinimized" class="chatbot-expanded">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-info">
        <img src="assets/ars-machina-logo.svg" alt="Ars Machina" class="avatar">
        <div class="info">
          <h3>Ars Machina Assistant</h3>
          <span class="status">Online • {{ getResponseTime() }}</span>
        </div>
      </div>
      <div class="header-actions">
        <button (click)="toggleSearch()" title="Buscar">🔍</button>
        <button (click)="exportConversation()" title="Exportar">📥</button>
        <button (click)="clearConversation()" title="Limpar">🗑️</button>
        <button (click)="toggleChat()" title="Minimizar">−</button>
      </div>
    </div>

    <!-- Search Bar -->
    <div *ngIf="showSearch" class="search-bar">
      <input [(ngModel)]="searchQuery" (input)="searchMessages()" placeholder="Buscar mensagens...">
      <button (click)="clearSearch()">×</button>
    </div>

    <!-- Messages -->
    <div class="chat-messages" #chatContainer>
      <div *ngFor="let message of filteredMessages; trackBy: trackByMessageId" 
           class="message" 
           [class.user]="message.sender === 'user'">
        
        <div class="message-content" [innerHTML]="formatMessageText(message.message)"></div>
        
        <!-- Quick Replies -->
        <div *ngIf="message.metadata?.quickReplies" class="quick-replies">
          <button *ngFor="let reply of message.metadata.quickReplies" 
                  (click)="onQuickReplyClick(reply)"
                  [disabled]="isLoading">
            {{ reply.icon }} {{ reply.text }}
          </button>
        </div>

        <!-- Message Footer -->
        <div class="message-footer">
          <span class="message-time">{{ formatTime(message.timestamp) }}</span>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div *ngIf="isLoading" class="message typing">
        <div class="typing-dots">
          <span></span><span></span><span></span>
        </div>
        {{ getTypingText() }}
      </div>
    </div>

    <!-- Input -->
    <div class="chat-input">
      <div class="input-group">
        <input 
          [(ngModel)]="userInput"
          (keydown.enter)="sendMessage()"
          placeholder="Digite sua mensagem..."
          [disabled]="isLoading">
        <button (click)="sendMessage()" [disabled]="!userInput.trim() || isLoading">
          {{ isLoading ? '⏳' : '➤' }}
        </button>
      </div>
      
      <!-- Quick Actions -->
      <div class="quick-actions">
        <button (click)="sendQuickMessage('Quais são os serviços da Ars Machina?')">🏗️ Nossos serviços</button>
        <button (click)="sendQuickMessage('Tenho uma ideia de projeto')">💡 Tenho uma ideia</button>
        <button (click)="sendQuickMessage('Preciso tirar algumas dúvidas')">❓ Tirar dúvidas</button>
        <button (click)="sendQuickMessage('Quero falar com um consultor')">📞 Falar conosco</button>
      </div>
    </div>
  </div>
</div>